# .github/workflows/book-seat.yml

name: 自动预约座位

# 允许您从 GitHub Actions 页面手动触发此工作流
on:
  workflow_dispatch:
    inputs:
      # [修改] 新增 "预约模式" 参数 (对应 main.py 的第4个参数)
      # 对应 sys.argv[3]
      scope_mode:
        description: '预约模式 (0=仅二层, 1=全部)'
        required: false
        default: '0' # 默认值 '0' (仅二层)
      
      # [修改] "刷新时间" 现在是第5个参数
      # 对应 sys.argv[4]
      refresh_time:
        description: '刷新间隔时间 (秒)'
        required: false
        default: '1.0' # 默认值 1.0 秒

jobs:
  book:
    # 使用最新的 Ubuntu 运行环境
    runs-on: ubuntu-latest

    steps:
      # 第1步：检出您的代码库
      # 这样 runner 才能访问到 main.py
      - name: 1. 检出代码
        uses: actions/checkout@v4

      # 第2步：设置 Python 3.11 环境
      - name: 2. 设置 Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 第3步：安装 main.py 所需的 Python 依赖库
      - name: 3. 安装 Python 依赖库
        run: |
          python -m pip install --upgrade pip
          # 安装脚本所需的三个关键库
          pip install httpx lxml pycryptodome

      # 第4步：运行预约脚本
      - name: 4. 运行预约脚本
        run: |
          # [修改] 调整参数顺序以匹配 main.py
          #
          # 用法: python3 main.py <学号> <密码> [模式] [刷新间隔]
          #
          # - ${{ secrets.STUDENT_ID }}：安全地从 Secrets 获取学号 (sys.argv[1])
          # - ${{ secrets.PASSWORD }}：安全地从 Secrets 获取密码 (sys.argv[2])
          # - ${{ inputs.scope_mode }}：从手动触发时输入的参数获取 "模式" (sys.argv[3])
          # - ${{ inputs.refresh_time }}：从手动触发时输入的参数获取 "刷新时间" (sys.argv[4])
          python3 main.py ${{ secrets.STUDENT_ID }} ${{ secrets.PASSWORD }} ${{ inputs.scope_mode }} ${{ inputs.refresh_time }}