# .github/workflows/book-seat.yml

name: 自动预约座位

# 允许您从 GitHub Actions 页面手动触发此工作流
on:
  workflow_dispatch:
    inputs:
      # 接收 "刷新时间" 作为输入参数 (对应信息.md)
      refresh_time:
        description: '刷新间隔时间 (秒)'
        required: false
        default: '1.0' # 默认值 1.0 秒

jobs:
  book:
    # 使用最新的 Ubuntu 运行环境
    runs-on: ubuntu-latest

    steps:
      # 第1步：检出您的代码库
      # 这样 runner 才能访问到 main.py
      - name: 1. 检出代码
        uses: actions/checkout@v4

      # 第2步：设置 Python 3.11 环境
      - name: 2. 设置 Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 第3步：安装 main.py 所需的 Python 依赖库
      - name: 3. 安装 Python 依赖库
        run: |
          python -m pip install --upgrade pip
          # 安装脚本所需的三个关键库
          pip install httpx lxml pycryptodome

      # 第4步：运行预约脚本
      - name: 4. 运行预约脚本
        run: |
          # 执行 main.py
          # - ${{ secrets.STUDENT_ID }}：安全地从 Secrets 获取学号
          # - ${{ secrets.PASSWORD }}：安全地从 Secrets 获取密码
          # - ${{ inputs.refresh_time }}：从手动触发时输入的参数获取刷新时间
          python3 main.py ${{ secrets.STUDENT_ID }} ${{ secrets.PASSWORD }} ${{ inputs.refresh_time }}